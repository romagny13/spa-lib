/*!
 * SpaLib v0.0.5
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.SpaLib=t.SpaLib||{})}(this,function(t){"use strict";function e(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function r(t){return"undefined"==typeof t}function n(t){return"undefined"!=typeof t}function o(t){return"string"==typeof t}function i(t){return"number"==typeof t}function s(t){return null!==t&&"object"==typeof t}function c(t){return"function"==typeof t}function a(t){return"boolean"==typeof t}function u(t){var e=new Date;return e.setTime(e.getTime()+24*t*60*60*1e3),e.toUTCString()}function h(t){try{var e=JSON.parse(t);return e}catch(t){return null}}function f(){return void 0!==typeof Storage}function p(){var t=window;return t.indexedDB||t.webkitIndexedDB||t.mozIndexedDB||t.msIndexedDB}function l(t,e){t.onerror=function(t){e(t)},t.onblocked=function(t){e(t)},t.onabort=function(t){e(t)}}function d(t){return t instanceof HTMLFormElement}function g(t){var e=t.toLocaleLowerCase();return"lostfocus"===e||"valuechanged"===e}function v(t){var e=t.toLocaleLowerCase();return"submit"===e||"valuechanged"===e}function m(t){return o(t)?document.querySelector(t):d(t)?t:void 0}function y(t){return"INPUT"===t.tagName?"checkbox"===t.type?M.CheckBox:"radio"===t.type?M.Radio:"range"===t.type?M.Range:M.Input:"TEXTAREA"===t.tagName?M.TextArea:"SELECT"===t.tagName?M.Select:M.Other}function _(t,e){return"string"===t?String(e):"number"===t?Number(e):"boolean"===t?Boolean(e):void 0}function b(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName}function w(t){return t!==M.CheckBox&&t!==M.Radio&&t!==M.Range}function C(t,e,r){return b(t)?"lostfocus"===r?["change"]:w(e)?["keyup","change"]:["change"]:[]}function E(t,e,r,n){if(n===M.Input||n===M.TextArea)t.value=r;else if(n===M.CheckBox)"boolean"===e?t.checked=r:t.checked=t.value===r;else if(n===M.Radio)t.checked=t.value===r;else if(n===M.Select){for(var o=t.options,i=0;i<o.length;i++)if(o[i].value===r){t.selectedIndex=i;break}}else t.innerHTML=r}function S(t,e){return e===M.Input?t.value:e===M.CheckBox||e===M.Radio?t.checked:e===M.Select?t.options[t.selectedIndex].value:e===M.Range?t.value:e===M.TextArea?t.value:void 0}function R(t,e,r,n){t.forEach(function(t){var o="boolean"===e?r.checked:_(e,r.value);o===t&&E(r,e,o,n)})}function T(t,e,r,n,o){if(r){var i=t.parentNode.querySelector(".help-block");i||(i=document.createElement("span"),i.classList.add("help-block"),t.parentNode.appendChild(i)),i.innerHTML=e[0]}n&&t.parentNode.classList.remove("has-success"),o&&t.parentNode.classList.add("has-error")}function O(t,e,r,n){if(e){var o=t.parentNode.querySelector(".help-block");o&&t.parentNode.removeChild(o)}r&&t.parentNode.classList.remove("has-error"),n&&t.parentNode.classList.add("has-success")}function k(t,e){var r=[];return e.forEach(function(e){e.validate(t)||r.push(e.error)}),r}function j(t){return t.getAttribute("name")}function N(t,e,r,n,o){e.length>0?T(t,e,r,n,o):O(t,r,n,o)}function P(t,e,r,n,o){var i=new $(t,e),s=typeof t[e];i.subscribe(function(t){E(r,s,t,n),o(t)})}function x(t,e,r,n){var o=new J(t);o.subscribe(function(t,e,r){"added"!==t&&"removed"!==t||n(t,e,r)})}function D(t,e,r,n){var o=C(t,e,r);o.forEach(function(e){t.addEventListener(e,n)})}function U(t,e,r){return t.replace(e,r)}function q(){return new XMLHttpRequest}function A(t,e,r,n){var o=new pt({method:t,url:e});return r&&(o.addHeader("content-type","application/json"),o.data=r),n&&o.addHeader("Authorization","Bearer "+n),o}function B(t){var e={},r=t.trim().split("\r\n");return r.forEach(function(t){var r=t.split(": ");r[1]&&(e[r[0]]=r[1])}),e}function I(t,e){var r=[];return e.forEach(function(e){c(e[t])&&r.push(e[t])}),r}function L(t,e){var r=new lt;return r.status=t.status,r.headers=B(t.getAllResponseHeaders()),r.content=e.responseType?t.response:t.responseText,r}function V(t,e){var r=q();if(!r)throw new Error("XMLHttpRequest not supported");if(r.open(t.method,t.url,t.async),t.headers)for(var n in t.headers)r.setRequestHeader(n,t.headers[n]);t.responseType&&(r.responseType=t.responseType),r.onreadystatechange=function(){4===r.readyState&&e(L(r,t))},r.send(t.data)}function H(t,e){var r=new St(null,e);return r._parent=t,r}var M,F=Array.isArray,z=function(){function t(){}return t.prototype.set=function(t,e,r){if(!o(t))throw new Error("Name required");if(!o(e))throw new Error("String value required");i(r)||(r=30),document.cookie=t+"="+e+";expires="+u(r)},t.prototype.get=function(t){if(!o(t))throw new Error("Name required");for(var e=document.cookie.split(";"),r=0;r<e.length;r++){var n=e[r].split("=");if(n[0].trim()===t)return n[1].trim()}},t.prototype.has=function(t){if(!o(t))throw new Error("Name required");return void 0!==this.get(t)},t.prototype.delete=function(t){return!!this.has(t)&&(this.set(t,"",-1),!0)},t.prototype.clear=function(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var r=t[e].split("=")[0];this.set(r,"",-1)}},t}(),G=function(){function t(t){this._indexedDB=p(),this._dbConfigs=n(t)&&t||[]}return t.prototype.getDbConfig=function(t){return this._dbConfigs.find(function(e){return e.name===t})},t.prototype.openCreateDb=function(t,e){var r=this;return new Promise(function(n,o){var i=r._indexedDB.open(t,e);l(i,o),i.onupgradeneeded=function(e){var n=e.target.result,o=r.getDbConfig(t);o&&F(o.objectStores)&&o.objectStores.forEach(function(t){n.objectStoreNames.contains(t.name)||r.createObjectStore(n,t.name,t.key,t.indexes)})},i.onsuccess=function(e){r._currentDb=e.target.result,r._currentDbName=t,r._currentConfig=r.getDbConfig(t),n(r._currentDb)}})},t.prototype.closeDb=function(){this._currentDb&&"close"in this._currentDb&&this._currentDb.close()},t.prototype.deleteDb=function(t){var e=this;return new Promise(function(r,n){e._currentDbName===t&&e.closeDb();var o=e._indexedDB.deleteDatabase(t);l(o,n),o.onsuccess=function(t){r(t)}})},t.prototype.createObjectStore=function(t,e,r,n){var o=t.createObjectStore(e,r);n&&n.forEach(function(t){var e=t.definition||{unique:!1};o.createIndex(t.name,t.key,e)})},t.prototype.getObjectStore=function(t,e,r){var n=this._currentDb.transaction([t],e);return r&&l(n,r),n.objectStore(t)},t.prototype.insert=function(t,e){var r=this;return new Promise(function(n,o){if(!r._currentDb)throw new Error("Require a connection opened");if(r._currentConfig&&r._currentConfig.created){var i=Date.now();e.created=i,e.modified=i}var s=r.getObjectStore(t,"readwrite",o);if(s){var c=s.add(e);l(c,o),c.onsuccess=function(t){n(t.target.result)}}})},t.prototype.update=function(t,e,r){var n=this;return new Promise(function(o,i){if(!n._currentDb)throw new Error("Require a connection opened");var s=n.getObjectStore(t,"readwrite",i),c=s.get(e);l(c,i),c.onsuccess=function(t){var e=t.target.result;if(e){n._currentConfig&&n._currentConfig.created&&(r.modified=Date.now());var c=s.put(r);l(c,i),c.onsuccess=function(){o(r)}}}})},t.prototype.delete=function(t,e){var r=this;return new Promise(function(n,o){if(!r._currentDb)throw new Error("Require a connection opened");var i=r.getObjectStore(t,"readwrite",o),s=i.delete(e);l(s,o),s.onsuccess=function(t){n(t)}})},t.prototype.count=function(t){var e=this;return new Promise(function(r,n){if(!e._currentDb)throw new Error("Require a connection opened");var o=e.getObjectStore(t,"readonly",n),i=o.count();l(i,n),i.onsuccess=function(t){r(t.target.result)}})},t.prototype.getAll=function(t){var e=this;return new Promise(function(r,n){if(!e._currentDb)throw new Error("Require a connection opened");var o=[],i=e.getObjectStore(t,"readonly",n),s=i.count();l(s,n),s.onsuccess=function(t){var e=t.target.result,s=i.openCursor();l(s,n),s.onsuccess=function(t){var n=t.target.result;if(n){var i=n.value;o.push(i),o.length===e?r(o):n.continue()}else r(o)}}})},t.prototype.getOne=function(t,e){var r=this;return new Promise(function(n,o){if(!r._currentDb)throw new Error("Require a connection opened");var i=r.getObjectStore(t,"readonly",o),s=i.get(e);l(s,o),s.onsuccess=function(t){n(t.target.result)}})},t}(),X=function(){function t(t){this._strategy=o(t)&&/^(local|session)$/i.test(t)?t:"local","local"===this._strategy?this._storage=localStorage:this._storage=sessionStorage}return t.prototype.set=function(t,e){try{var r=s(e)?JSON.stringify(e):e;this._storage[t]=r}catch(t){}},t.prototype.get=function(t){var e=this._storage[t],r=h(e);return r?r:e},t.prototype.has=function(t){return void 0!==this._storage[t]},t.prototype.remove=function(t){return!!this.has(t)&&(this._storage.removeItem(t),!0)},t.prototype.getValues=function(){for(var t=[],e=0;e<this._storage.length;e++){var r=this.get(this._storage.key(e));t.push(r)}return t},t.prototype.getKeys=function(){return Object.keys(this._storage)},t.prototype.clear=function(){this._storage.clear()},t}(),K=function(){var t={},e=new X,r=function(){function r(){}return Object.defineProperty(r.prototype,"length",{get:function(){return Object.keys(t).length},enumerable:!0,configurable:!0}),r.prototype.has=function(e){return t.hasOwnProperty(e)},r.prototype.store=function(e,r){t[e]=r},r.prototype.retrieve=function(e){if(this.has(e))return t[e]},r.prototype.remove=function(e){return!!this.has(e)&&(delete t[e],!0)},r.prototype.clear=function(){t={}},r.prototype.save=function(r){e.set(r,t)},r.prototype.restore=function(r){var n=e.get(r);return!!n&&(t=n,!0)},r}();return r}(),$=function(){function t(t,e){function r(t){o._subscribers.forEach(function(e){e(t)})}var n=t[e],o=this;this._subscribers=[],Object.defineProperty(t,e,{get:function(){return n},set:function(t){n=t,r(t)},enumerable:!0,configurable:!0})}return t.prototype.subscribe=function(t){this._subscribers.push(t)},t.prototype.unsubscribe=function(t){var e=this._subscribers.indexOf(t);return e!==-1&&(this._subscribers.splice(e,1),!0)},t}(),J=function(){function t(t){function e(t,e,r){n._subscribers.forEach(function(n){n(t,e,r)})}var n=this;if(!F(t))throw new TypeError("Array required");this._subscribers=[],this._array=t,t.push=function(){for(var r=0;r<arguments.length;r++){var n=arguments[r],o=t.length;Array.prototype.push.call(t,n),e("added",n,o)}return t.length},t.unshift=function(){for(var r=0;r<arguments.length;r++){var n=arguments[r];t.splice(r,0,n),e("added",n,r)}return t.length},t.splice=function(t,n){for(var o=this,i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var c=[];if(r(t)||r(n))return c;for(;n--;){var a=n+t,u=Array.prototype.splice.call(this,a,1)[0];e("removed",u,a)}return i.forEach(function(r,n){Array.prototype.splice.call(o,t,0,r),e("added",r,n),t++}),c},t.shift=function(){if(t.length>-1){var r=Array.prototype.shift.call(this);return e("removed",r,0),r}},t.pop=function(){var r=t.length-1;if(r>-1){var n=Array.prototype.pop.call(this);return e("removed",n,r),n}},t.sort=function(r){return Array.prototype.sort.call(this,r),e("sorted",t,null),t},t.filter=function(r){var n=[];return t.forEach(function(t){r(t)&&n.push(t)}),e("filtered",n,null),n},t.resetFilter=function(){return e("filtered",t,null),t}}return t.prototype.subscribe=function(t){this._subscribers.push(t)},t.prototype.unsubscribe=function(t){var e=this._subscribers.indexOf(t);return e!==-1&&(this._subscribers.splice(e,1),!0)},t}();!function(t){t[t.CheckBox=0]="CheckBox",t[t.Radio=1]="Radio",t[t.Input=2]="Input",t[t.Range=3]="Range",t[t.Select=4]="Select",t[t.TextArea=5]="TextArea",t[t.Other=6]="Other"}(M||(M={}));var Q,W=function(){function t(t,e){if(!o(t))throw new Error("Name required (target form element name/source property name)");this.name=t,this.validators=[];var r=o(e)?e:"valuechanged";this.setUpdateType(r)}return t.prototype.setUpdateType=function(t){if(!o(t))throw new Error("Update type required");if(!g(t))throw new Error("Invalid update type (valuechanged|lostfocus)");return this.updateType=t,this},t.prototype.addValidator=function(t){return this.validators.push(t),this},t}(),Y=function(){function t(t,e,r,n){this.validationType=o(t)&&v(t)?t:"submit",this.formElementConfigs={},this.showErrorMessages=!a(e)||e,this.cssClassOnSuccess=!a(r)||r,this.cssClassOnError=!a(n)||n}return t.prototype.addFormElementConfig=function(t){return this.formElementConfigs[t.name]=t,this},t.prototype.getFormElementConfig=function(t){if(this.formElementConfigs.hasOwnProperty(t))return this.formElementConfigs[t]},t}(),Z=function(){function t(t,e,r,n,o){this.formBinding=t,this.element=e,this.bindedName=r,this.formElementConfig=n,this.formConfig=o,this._subscribers=[],this._elementType=y(e)}return t.prototype._raiseStateChanged=function(t,e){this._subscribers.forEach(function(r){r(t,e)})},t.prototype._checkState=function(t,e){var r=t[0],n=o(r);this.hasError===n&&this.firstError===r||(this.hasError=n,this.firstError=r,this.errors=t,this._raiseStateChanged(this.element,t),e())},t.prototype.onStateChanged=function(t){this._subscribers.push(t)},t}(),tt=function(t){function r(e,r,n,o,i,s,c,a){var u=t.call(this,e,r,n,o,i)||this;return u.source=s,u.sourceValue=c,u.type=a,u._bind(u.element,u._elementType,u.source,u.bindedName,u.sourceValue,u.type,u.formElementConfig,u.formConfig),u}return e(r,t),r.prototype._bind=function(t,e,r,n,o,i,s,c){var a,u=this;D(t,e,s.updateType,function(t){var e="boolean"===i?t.target.checked:_(i,t.target.value);r[n]=e}),P(r,n,t,e,function(e){if(a||u.formBinding.canValidate){var r=k(e,s.validators);u._checkState(r,function(){N(t,r,c.showErrorMessages,c.cssClassOnSuccess,c.cssClassOnError)}),a=!0}}),E(t,i,o,e)},r.prototype.validate=function(){var t=this.source[this.bindedName];return this.errors=k(t,this.formElementConfig.validators),this.hasError=this.errors.length>0,this.errors},r}(Z),et=function(t){function r(e,r,n,o,i,s,c){var a=t.call(this,e,r,n,o,i)||this;return a.source=s,a.sourceValue=c,a.type=c[0]?typeof c[0]:"string",a._bind(a.element,a._elementType,a.sourceValue,a.type,a.formElementConfig,a.formConfig),a}return e(r,t),r.prototype._bind=function(t,e,r,n,o,i){var s,c=this;D(t,e,o.updateType,function(t){var e="boolean"===n?t.target.checked:_(n,t.target.value),o=r.indexOf(e);o===-1?r.push(e):r.splice(o,1)}),x(r,t,e,function(a,u,h){if(R(r,n,t,e),s||c.formBinding.canValidate){var f=k(u,o.validators);c._checkState(f,function(){N(t,f,i.showErrorMessages,i.cssClassOnSuccess,i.cssClassOnError)}),s=!0}}),R(r,n,t,e)},r.prototype.validate=function(){var t=this.source[this.bindedName];return this.errors=k(t,this.formElementConfig.validators),this.hasError=this.errors.length>0,this.errors},r}(Z),rt=function(t){function r(e,r,n,o,i){var s=t.call(this,e,r,n,o,i)||this;return s._bind(s.element,s._elementType,s.formElementConfig,s.formConfig),s}return e(r,t),r.prototype._bind=function(t,e,r,n){var o,i=this;D(t,e,r.updateType,function(e){if(o||i.formBinding.canValidate){var s=S(t,i._elementType);i.value=s;var c=k(s,r.validators);i._checkState(c,function(){N(t,c,n.showErrorMessages,n.cssClassOnSuccess,n.cssClassOnError)}),o=!0}})},r.prototype.validate=function(){var t=S(this.element,this._elementType);return this.value=t,this.errors=k(t,this.formElementConfig.validators),this.hasError=this.errors.length>0,this.errors},r}(Z),nt=function(){function t(t,e,r){this.element=t,this.message=e,this.value=r}return t}(),ot=function(){function t(t,e,r,n){this.hasError=t,this.errors=e,this.form=r,this.source=n}return t}(),it=function(){function t(t,e,r){this._subscribers=[],this._stateSubscribers=[],this._bindings=[],this.submitted=!1;var o=m(t);if(!o)throw new Error("No element found for the form");this.form=o,this.source=e,this.formConfig=n(r)?r:new Y,this.validationType=r.validationType,this._bind(o,e,this.formConfig),this._bindSubmit(o,e,this.formConfig)}return Object.defineProperty(t.prototype,"canValidate",{get:function(){return this.submitted||"valuechanged"===this.validationType},enumerable:!0,configurable:!0}),t.prototype._bind=function(t,e,r){for(var n=this,o=0;o<t.elements.length;o++){var i=t.elements[o];if("submit"!==i.type){var s=b(i),c=j(i);if(s&&c){var a=r.getFormElementConfig(c);if(e&&e.hasOwnProperty(c)){var u=e[c],h=typeof u;if(a||(a=new W(c),r.addFormElementConfig(a)),"string"===h||"number"===h||"boolean"===h){var f=new tt(this,i,c,a,r,e,u,h);f.onStateChanged(function(t,e){n._raiseStateChanged(t,e)}),this._bindings.push(f)}else if(F(u)){var f=new et(this,i,c,a,r,e,u);f.onStateChanged(function(t,e){n._raiseStateChanged(t,e)}),this._bindings.push(f)}}else if(W){var f=new rt(this,i,c,a,r);f.onStateChanged(function(t,e){n._raiseStateChanged(t,e)}),this._bindings.push(f)}}}}},t.prototype._validateAll=function(t,e,r){var n=!1,o=[],i={};this._bindings.forEach(function(t){if(!i.hasOwnProperty(t.bindedName)){var e=t instanceof tt?t.sourceValue:t.value,s=t.validate();s.length>0&&(n=!0,o.push(new nt(t.element,s[0],e))),N(t.element,s,r.showErrorMessages,r.cssClassOnSuccess,r.cssClassOnError),i[t.bindedName]="validated"}}),this.submitted=!0;var s=new ot(n,o,this.form,this.source);this._raise(s)},t.prototype._bindSubmit=function(t,e,r){var n=this;t.addEventListener("submit",function(o){o.preventDefault(),n._validateAll(t,e,r)})},t.prototype._raise=function(t){this._subscribers.forEach(function(e){e(t)})},t.prototype._raiseStateChanged=function(t,e){this._validateAll(this.form,this.source,this.formConfig),this._stateSubscribers.forEach(function(r){r(t,e)})},t.prototype.onStateChanged=function(t){this._stateSubscribers.push(t)},t.prototype.onSubmit=function(t){this._subscribers.push(t)},t}(),st=function(){function t(){}return t}(),ct=function(t){function n(e){var r=t.call(this)||this;return r.message=o(e)?e:"This field is required.",r}return e(n,t),n.prototype.validate=function(t){return null===t||r(t)||""===t||a(t)&&t===!1?(this.error=this.message,!1):(this.error=void 0,!0)},n}(st),at=function(t){function r(e,r){var n=t.call(this)||this;return n.minLength=i(e)?e:3,n.message=o(r)?r:U("Please enter at least than {0} characters.","{0}",e),n}return e(r,t),r.prototype.validate=function(t){return t&&t.length<this.minLength?(this.error=this.message,!1):(this.error=void 0,!0)},r}(st),ut=function(t){function r(e,r){var n=t.call(this)||this;return n.maxLength=i(e)?e:30,n.message=o(r)?r:U("Please enter no more than {0} characters.","{0}",e),n}return e(r,t),r.prototype.validate=function(t){return t&&t.length>this.maxLength?(this.error=this.message,!1):(this.error=void 0,!0)},r}(st),ht=function(t){function r(e,r){var n=t.call(this)||this;return n.pattern=e,n.message=o(r)?r:"Please fix this field.",n}return e(r,t),r.prototype.validate=function(t){return n(t)&&!this.pattern.test(t)?(this.error=this.message,!1):(this.error=void 0,!0)},r}(st),ft=function(t){function r(e,r){var n=t.call(this)||this;return n.fn=e,n.message=o(r)?r:"Please fix this field.",n}return e(r,t),r.prototype.validate=function(t){return this.fn(t)?(this.error=void 0,!0):(this.error=this.message,!1)},r}(st),pt=function(){function t(t){if(!o(t.url))throw new Error("Url required");if(this.headers={},t.headers)for(var e in t.headers)this.addHeader(e,t.headers[e]);this.url=t.url,this.method=o(t.method)&&/^(GET|POST|PUT|DELETE|HEAD|OPTIONS|PATCH)$/i.test(t.method)?t.method:"GET",this.async=!a(t.async)||t.async,this.data=n(t.data)?t.data:null,t.responseType&&(this.responseType=t.responseType)}return t.prototype.addHeader=function(t,e){return this.headers[t]=e,this},t.prototype.setResponseType=function(t){return this.responseType=t,this},t}(),lt=function(){function t(){}return Object.defineProperty(t.prototype,"isSuccessStatusCode",{get:function(){return/^(200|201|202|203|204|205|206|304)$/.test(this.status.toString())},enumerable:!0,configurable:!0}),t}(),dt=function(){function t(){this.interceptors=[]}return t.prototype.intercept=function(t,e,r,n){function o(t){t(e,function(t){t?(c++,c<s?o(i[c]):r()):n()})}var i=I(t,this.interceptors),s=i.length,c=0;s>0?o(i[0]):r&&r()},t.prototype.load=function(t,e,n){if(r(t))throw new Error("Url required");var o=new pt({url:t});V(o,function(t){200===t.status?e(t.content):n&&n(t)})},t.prototype.send=function(t){var e=this;return new Promise(function(r,n){e.intercept("before",t,function(){try{V(t,function(t){e.intercept("after",t,function(){t.isSuccessStatusCode?r(t):n(t)},function(){n(t)})})}catch(t){n(t)}},function(){var t=new lt;t.status=401,n(t)})})},t.prototype.get=function(t,e){var r=A("GET",t,null,e);return this.send(r)},t.prototype.post=function(t,e,r){var n=A("POST",t,e,r);return this.send(n)},t.prototype.put=function(t,e,r){var n=A("PUT",t,e,r);return this.send(n)},t.prototype.delete=function(t,e){var r=A("DELETE",t,null,e);return this.send(r)},t}(),gt=function(){function t(){this._cache={}}return t.prototype.getSubscribers=function(t){return this._cache[t]},t.prototype.isRegistered=function(t){return this._cache.hasOwnProperty(t)},t.prototype.subscribe=function(t,e){if(r(t))throw new Error("Event required");if(r(e))throw new Error("Subscriber required");this.isRegistered(t)||(this._cache[t]=[]),this._cache[t].push(e)},t.prototype.publish=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.isRegistered(t)&&this._cache[t].forEach(function(t){t.apply(void 0,e)})},t.prototype.unsubscribe=function(t,e){if(r(t))throw new Error("Event required");if(this.isRegistered(t)){if(!c(e))return delete this._cache[t],!0;var n=this._cache[t].indexOf(e);if(n!==-1)return this._cache[t].splice(n,1),!0}return!1},t.prototype.clear=function(){this._cache={}},t}(),vt=function(){function t(t){if(r(t))throw new Error("Config required");if(r(t.clientId))throw new Error("clientId required");if(r(t.redirectUrl))throw new Error("redirectUrl required");this._http=new dt,this.clientId=t.clientId,this.redirectUrl=t.redirectUrl}return t.prototype.getCodeUrl=function(){if(r(this.authUrl))throw new Error("authUrl required");return this.authUrl+"?client_id="+this.clientId+"&redirect_uri="+this.redirectUrl+"&scope="+this.scope+"&response_type=code"},t.prototype.getProfile=function(t){var e=this;if(r(t))throw new Error("access_token required");if(r(this.profileUrl))throw new Error("profileUrl required");var n=r(this.fields)?this.profileUrl:this.profileUrl+"?fields="+this.fields;return new Promise(function(r,o){e._http.get(n,t).then(function(t){r(t.content)}).catch(function(t){o(t)})})},t.prototype.getTokenUrl=function(){if(r(this.authUrl))throw new Error("authUrl required");return this.authUrl+"?client_id="+this.clientId+"&redirect_uri="+this.redirectUrl+"&scope="+this.scope+"&response_type=token"},t}(),mt=function(t){function r(e){var r=t.call(this,e)||this;return r.scope=e.scope||"public_profile,email",r.authUrl=e.authUrl||"https://www.facebook.com/dialog/oauth",r.profileUrl=e.profileUrl||"https://graph.facebook.com/me",r.fields=e.fields||"id,name,email",r}return e(r,t),r}(vt),yt=function(t){function r(e){var r=t.call(this,e)||this;return r.scope=e.scope||"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",r.authUrl=e.authUrl||"https://accounts.google.com/o/oauth2/auth",r.profileUrl=e.profileUrl||"https://www.googleapis.com/oauth2/v1/userinfo",r}return e(r,t),r}(vt),_t=function(){function t(){this._cache={},this._cacheSize=100}return t.prototype._generateKey=function(){return"__p_"+Math.random().toString(36).substr(2,9)},t.prototype._retrieve=function(t){if(this._cache.hasOwnProperty(t))return this._cache[t]},t.prototype._checkCacheSize=function(){this._currentSize===this._cacheSize&&this.clear()},t.prototype.getNewId=function(){this._checkCacheSize();var t=this._generateKey(),e=t+".0";return this._cache[t]=[e],this._currentSize++,e},t.prototype.getId=function(t){if("string"==typeof t){var e=t.split(".")[0],r=this._retrieve(e);if(r){var n=e+"."+r.length;return this._cache[e].push(n),n}}return this.getNewId()},t.prototype.clear=function(){this._cache={},this._currentSize=0},t}(),bt=new _t;!function(t){t[t.waitCompleteCallBack=0]="waitCompleteCallBack",t[t.waitRejectionCallBack=1]="waitRejectionCallBack",t[t.waitResolveOrReject=2]="waitResolveOrReject",t[t.completed=3]="completed",t[t.none=4]="none"}(Q||(Q={}));var wt;!function(t){t[t.all=0]="all",t[t.race=1]="race"}(wt||(wt={}));var Ct=function(){function t(){}return t.prototype._doComplete=function(t){try{this._pending=void 0,this._state=Q.completed;var e=this._onComplete(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._doRejection=function(t){try{this._pending=void 0,this._state=Q.completed;var e=this._onReject(t);this._child.resolve(e)}catch(t){this._child.reject(t)}},t.prototype._setPending=function(t,e){this._state=t,this._pending=e},t.prototype.resolve=function(t){this._onComplete?this._doComplete(t):this._setPending(Q.waitCompleteCallBack,t)},t.prototype.reject=function(t){this._onReject?this._doRejection(t):this._setPending(Q.waitRejectionCallBack,t)},t}(),Et=function(t){function r(e,r){var n=t.call(this)||this;return n._id=bt.getNewId(),n._promiseResults=[],n._pendingNotify=[],n._mode=r,n._promises=e,n._mode===wt.all?n._iteratePromises(e):n._mode===wt.race&&n._race(e),n}return e(r,t),r.prototype._notifyPendings=function(){var t=this;this._pendingNotify.length>0&&(this._pendingNotify.forEach(function(e){t._onNotify(e)}),this._pendingNotify=[])},r.prototype._doNotification=function(t){this._onNotify?this._onNotify(t):this._pendingNotify.push(t)},r.prototype._nextPromise=function(t,e,r,o){var i=this;t.then(function(t){i._doNotification(t),n(t)&&i._promiseResults.push(t),r++,r<o?i._nextPromise(e[r],e,r,o):i.resolve(i._promiseResults)},function(t){i.reject(t)})},r.prototype._iteratePromises=function(t){var e=t.length,r=0;e>0?this._nextPromise(t[0],t,r,e):this.resolve([])},r.prototype._race=function(t){var e=this;t.forEach(function(t){t.then(function(t){e._state!==Q.completed&&(n(t)&&e._promiseResults.push(t),e.resolve(t))},function(t){e.reject(t)})})},r.prototype.then=function(t,e,r){return this._child=H(this,this._id),this._onComplete=t,this._onReject=e,this._onNotify=r,c(this._onNotify)&&this._notifyPendings(),this._state===Q.waitCompleteCallBack?this._doComplete(this._promiseResults):this._state===Q.waitRejectionCallBack?c(this._onReject)&&this._doRejection(this._pending):this._state=Q.waitResolveOrReject,this._child},r.prototype.catch=function(t){return this.then(this._onComplete,t,this._onNotify)},r}(Ct),St=function(t){function r(e,r){var n=t.call(this)||this;if(r?n._id=bt.getId(r):n._id=bt.getNewId(),c(e))try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n}return e(r,t),r.prototype.then=function(t,e){return this._child=H(this,this._id),this._onComplete=t,this._onReject=e,this._state===Q.waitCompleteCallBack?this._doComplete(this._pending):this._state===Q.waitRejectionCallBack?c(this._onReject)&&this._doRejection(this._pending):this._state=Q.waitResolveOrReject,this._child},r.prototype.catch=function(t){return this._parent._state===Q.completed?this.then(this._onComplete,t):this._parent.then(this._onComplete,t)},r.all=function(t){return new Et(t,wt.all)},r.race=function(t){return new Et(t,wt.race)},r}(Ct);t.Cache=K,t.FormBinding=it,t.CustomValidator=ft,t.FormConfig=Y,t.FormElementConfig=W,t.MaxLengthValidator=ut,t.MinLengthValidator=at,t.PatternValidator=ht,t.RequiredValidator=ct,t.Validator=st,t.FormSubmittedResponse=ot,t.FormElementError=nt,t.Http=dt,t.HttpRequest=pt,t.HttpResponse=lt,t.Messenger=gt,t.Observable=$,t.ObservableArray=J,t.FacebookAuth=mt,t.GoogleAuth=yt,t.OAuth=vt,t.TSPromise=St,t.IndexedDBService=G,t.StorageService=X,t.CookieService=z,t.supportStorage=f,Object.defineProperty(t,"__esModule",{value:!0})});